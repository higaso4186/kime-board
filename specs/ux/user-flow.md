# ユーザー導線（User Flow）

キメボードの画面遷移・ユーザージャーニーを整理し、UX 改善のディスカッション土台とする。

## 0. 実施進捗（2026-02-15）

### 完了

- [x] ヘッダーの「新規会議メモ」を**決裁が空のときのみ表示**に変更
- [x] サイドバーから「管理職ビュー」を外し、**ダッシュボードに統合**
- [x] `/exec` は互換のためページを残しつつ、**ダッシュボードへ自動遷移**に変更
- [x] 会議詳細に**議事録貼り付け・送信 UI**を追加
- [x] 会議詳細のエージェントログを常時表示から**折りたたみ + 右パネル導線**へ変更
- [x] 決裁詳細の低頻度項目（根拠/前提/反証条件）を**折りたたみ編集**に変更
- [x] 決裁一覧に「次に会議で決める / 材料を揃える / 決裁済み」のサマリを追加
- [x] フロービューで**決裁とアクションの識別性**を改善（色差 + カード形状 + アイコン）
- [x] 決裁詳細を「**議題化前提の入力**」へ変更（選択肢ごとのメリット/デメリット/備考）
- [x] 不足質問を決裁詳細の**Prepアクション**として統合
- [x] 決裁詳細の「確定」を廃止し、**議題に上げる（会議一覧で紐づけ）**導線へ変更
- [x] ユーザー表示の重複文言を解消（名前未設定/メール未設定を明示）
- [x] 決裁詳細からカテゴリ入力/UIを削除（MVPでは扱わない）
- [x] 決裁詳細の「会議を作る」導線を削除（2回目以降は会議一覧で運用）
- [x] 決裁詳細ヘッダー下のチップ群を撤去し、右カラム上部にメタ情報ブロックを配置
- [x] 選択肢のメリット/デメリット/備考は**任意入力**に変更（必須解除）
- [x] 右パネルのチケットを「この決裁 / その他」に分離し、クリックでその直下にチャット UI を表示。詳細チャットで開く時はパネルを自動で閉じる（二重表示を防止）
- [x] 決裁詳細のレイアウトをレスポンシブ化（1カラム→2カラムへ段階変化）
- [x] 既存の固定値の一部（メンバー初期表示、会議メモ参加者初期値、Cloud Tasks default location）を JSON 化

### 継続（この方針で合わせて進める）

- [ ] dependsOn（決裁→決裁 direct）のモデル化とフロー表示
- [ ] モバイル時の導線（サイドバー・右パネル・カンバン列数）の再設計
- [ ] 決裁詳細のメタ情報（タグ/期限/決裁者）の表示密度最適化
- [ ] API/Web の残ハードコード棚卸し（文言以外の固定データを優先）

## 1. 前提とペルソナ

| ペルソナ | 主な利用シーン |
|----------|----------------|
| **実行メンバー** | 決裁一覧でフェーズ確認 → 決裁詳細で必要な情報を入力・更新。会議メモで議事録を投入 |
| **管理職 / 意思決定者** | 決裁可能なものを判別・承認。「決裁をする場」（会議）で決める |

## 1.5 データと決裁の流れ（前提となる理論）

決裁を行うには、まず**元データ**が必要である。

**新規会議メモ**は**初回だけ**。同じプロジェクトでは決裁をまとめた会議が存在するので、その会議に対して議事録を貼り付けて送信すると、次の決裁・アクションが紐づいて出る。

```
【初回: 決裁が空】
  議事録 → 新規会議メモで貼り付け・送信 → AI 解析 → 決裁一覧（初回抽出）
                                              │
【2回目以降: 決裁・会議が既にある】
  議事録 → 該当会議の画面で貼り付け・送信 → AI 解析 → 次の決裁・アクションが紐づいて出る
                                              │
【共通】
  ユーザーが決裁材料を入力・更新 → 「決裁をする場」で決める
```

→ **決裁が空のときだけ**新規会議メモを表示すればよく、UI がすっきりする。

| 要素 | 説明 |
|------|------|
| **決裁材料** | 決めるために必要な情報（決裁者・期限・判断基準・選択肢など）。不足があると「情報不足」となる |
| **決裁後のアクション** | 決めた後にやるべきこと（Prep: 準備 / Exec: 実行）。決裁だけでは何も進まない |

→ 決裁フローとして「情報不足 → 決裁可能 → 決裁済み」という整理は妥当。

## 2. 画面構成と遷移マップ

```
/projects（プロジェクト一覧）
    │
    └── プロジェクトを開く
            │
            ▼
        /p/:id/decisions ← デフォルト（決裁一覧）【メイン導線】
            │
            ├── 看板 or リストでフェーズ確認 → 決裁詳細で情報入力・更新
            ├── 新規決裁（手動）
            ├── 新規会議メモ（決裁が空のときのみ表示）
            ├── 会議一覧（決裁を決める場のアジェンダ）
            │       └── 会議詳細 / 議事録を貼り付けて送信 → 次の決裁・アクションが紐づく
            └── 管理権限（サイドバー）
                    ├── ダッシュボード（KPI・サマリ・承認待ち・決裁者俯瞰を統合）
                    └── ロール/メンバー
```

## 3. 主要導線

### 3.1 プロジェクトを開いたとき

- **現状**: `/p/:id` にアクセスすると決裁一覧へリダイレクト
- **理由**: ダッシュボードは管理権限向けの KPI サマリ。一般ユーザーの主目的は決裁の確認・更新

### 3.2 決裁（メイン導線）

**通常ユーザー**は決裁一覧を開き、進んでいない・決裁中のものを対象に、**決裁に必要な情報を入力**する。

| 導線 | 説明 |
|------|------|
| 決裁一覧 | **看板** or **リスト**で、どの決裁がどのフェーズかを確認 → 該当決裁を選んで更新 |
| 決裁詳細 | 選んだ決裁に対して、決裁者・期限・判断基準など**必要な情報を入力**。質問への回答もここで |
| 新規決裁 | 手動作成。議事録由来は会議詳細での貼り付け・送信から生成 |

導線の流れ: **決裁一覧でフェーズ確認 → 決裁詳細で情報入力・更新**

### 3.2.1 決裁のつながり（複雑性の可視化）

**決裁は、次のアクションまたは次の決裁のためにある**。それらがすべて確定したら決裁として完了。

| つながりの型 | 説明 |
|-------------|------|
| **決裁 → アクション → 次の決裁** | 基本形。決裁 A のアクションが決裁 B の準備をする（材料を集める）。決裁→決裁 direct はあまり想定しない |
| **決裁 → 決裁** | 直接依存もある場合あり（B は A が決まらないと進められない、など） |

こうした複雑さを**可視化**し、誰もが同じ理解で進められるようにする設計が重要。

| 現状の可視化 | 説明 |
|--------------|------|
| フロー表示 | 決裁とアクションの紐づき、アクションが別決裁を支援する関係を図で表示 |
| 課題 | 決裁同士の直接依存（dependsOn）も一部ケースで表現できるとよい |

### 3.3 会議（決裁と同列ではない）

**キメボードの「会議」**は、決裁と同列ではない。明確に定例会議・進捗会議とは別の位置づけである。

| 定義 | 説明 |
|------|------|
| **キメボードの会議** | 決裁が集まったときに**決裁をする場**として定義する。「何をどう決めるか」をまとめたものが会議（アジェンダ） |
| 定例会議・進捗会議 | 通常の会議種別。キメボードの会議とは区別する |

| 導線 | 説明 |
|------|------|
| 会議一覧 | 決裁をする場の一覧。各会議 = 決める決裁のアジェンダ |
| 会議詳細 | **何をどう決めるか**のまとめ。決裁候補とタイムボックス。ここに**議事録を貼り付けて送信** → 次の決裁・アクションが紐づいて出る |
| **新規会議メモ** | **決裁が空のときだけ表示**。初回はここで議事録を貼り付け → AI 解析 → 決裁一覧ができる |

### 3.4 管理権限（サイドバー下部）

**ダッシュボードと管理職ビューは分ける必要がない**。基本はダッシュボードに統合する。

| 画面 | 想定ユーザー | 説明 |
|------|--------------|------|
| **ダッシュボード** | プロジェクト管理者・意思決定者 | KPI（未決/決められる/期限超過）、承認待ち・決裁者俯瞰を一元化 |
| ロール/メンバー | 管理者 | 権限・メンバー管理 |

## 4. ディスカッション候補（TODO）

### 導線・遷移
- [x] **ダッシュボードに管理職ビューを統合**（`/exec` を廃止し、ダッシュボード内に取り込む）
- [ ] プロジェクト切り替え時のデフォルト画面の扱い
- [ ] 決裁のフィルタ・ソートのデフォルト値
- [x] **新規会議メモの条件表示**（決裁が空のときだけ表示する実装）
- [ ] 右パネル（チャット・ログ）の開き方・コンテキスト
- [ ] 未ログイン時のランディング / 導線
- [ ] モバイル・小画面での導線

### 決裁のつながり・可視化
- [ ] 決裁同士の直接依存（dependsOn）のモデル化と表示
- [ ] フロー図の使い方（いつ見るか、誰が見るか）
- [ ] 認識齟齬を防ぐための共通ビュー（チーム全員が同じ図を見て話せる状態）

### 視認性・情報設計・UX（徹底議論）

現在、視認性や目線の導線は設計されていない。以下を**徹底的に議論**する。

#### 4.3.1 必要・不要の項目選定

各画面要素について「毎回見るか / たまにしか見ないか / 不要か」を検討する。

| 観点 | 問いかけの例 |
|------|-------------|
| 必要度 | この項目は 80% のセッションで必要か？なければデフォルトで隠す候補 |
| 頻度 | 入力・確認の頻度は？低いものはサイドパネル・ドロワー・モーダルに退避 |
| 優先度 | メイン導線（決裁確認→情報入力）を阻害していないか |

→ 決裁一覧・決裁詳細・ヘッダー・サイドバーの各要素を洗い出し、必要・不要・退避先を決める。

#### 4.3.2 グルーピングと境界線

**線で区切りすぎると見づらい**。グルーピングの方針を議論する。

| 観点 | 問いかけの例 |
|------|-------------|
| 区切り | 線（border）ではなく、余白・背景色・カード単位でまとめる方がよいか |
| グルーピング | 関連するものは近くに、無関係なものは離す。1 画面あたりの論理ブロック数を抑える |
| 視覚ノイズ | 細かい区切り線・枠を減らし、本当に必要な境界だけ残す |

→ 現状の Card / border 多用を見直し、情報の塊としてまとめる。

#### 4.3.3 サイドパネル戦略

**必要な時だけ入力・確認するものは、サイドパネル的に隠す**方が戦略的。

| 対象の例 | 理由 |
|----------|------|
| チャット・不足質問 | 決裁詳細を見ているときだけ開く。常時表示不要 |
| エージェントログ | デバッグ・確認時のみ。普段は閉じる |
| メタ情報・設定 | 決裁者・期限・タグなど、編集時のみ表示してよいもの |

→ 「何を常時表示し、何を開閉可能にするか」を各画面で定義する。

#### 4.3.4 議論のアジェンダ（TODO）

- [ ] 各画面の項目一覧を作り、必要・不要・サイドパネル候補を選定
- [x] グルーピング方針（線の使い方・余白・背景）を決める
- [x] サイドパネル／ドロワー／モーダルの使い分けルール
- [ ] 目線の導線（Z や F パターン、「次にやるべきもの」への誘導）

---

## 5. 現状構成と変更計画（ページ別）

各ページの**現在の構成**と**要件に基づく変更**を整理する。

### 5.1 共通（ProjectShell）

| 領域 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| **ヘッダー** | ロゴ、プロジェクト切替、検索、新規会議メモ、新規決裁、パネル開閉 | 新規会議メモは決裁が空のときだけ | 新規会議メモを条件表示（`decisions.length === 0` のときのみ） |
| **サイドバー** | 決裁、会議、管理権限（ダッシュボード、管理職ビュー、ロール/メンバー）、ユーザー Card | ダッシュボードと管理職ビューを統合 | 「管理職ビュー」を削除、ダッシュボードに統合 |
| **右パネル** | チャット（不足質問）、エージェントログ。開閉可能 | 必要な時だけ開く = 現状で概ね良い | 開閉のデフォルト（閉）のまま。詳細は下記「右パネル（チャット・チケット）」 |

##### 右パネル（チャット・チケット）の詳細仕様

右パネルは**チケット単位でチャットを直下表示**し、詳細チャットへの遷移時は**パネルを自動で閉じる**。

| ルール | 動作 |
|--------|------|
| **チケットの並び** | 「この決裁に関するチケット」「その他のチケット」の 2 セクションに分離 |
| **チケットをクリック** | クリックしたチケットの**直下**にチャット UI（SimpleChatUI）を表示。他チケットは折りたたむ |
| **チャットの配置** | 選択中チケットの直下に、回答入力＋送信ボタンを表示。同じ UI コンポーネントを使用 |
| **詳細チャットで開く** | クリック時に**サイドパネルを閉じてから** `/p/:id/chat?decisionId=...` へ遷移。パネルを開いたままにしない（チャットが 2 箇所で重複表示されるのを防ぐ） |
| **Esc** | パネルを閉じる |

### 5.2 決裁一覧（/p/:id/decisions）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| ツールバー | 新規決裁、カンバン/リスト/フロー切替、並び順 Select | 導線: フェーズ確認 → 決裁詳細 | 現状維持。視認性は要検討 |
| 本体 | カンバン: 4列（NEEDS_INFO/READY/DECIDED/REOPEN）。リスト: 一覧。フロー: 決裁↔アクション図 | Card・border 多用 | グルーピング見直し。線を減らし余白・背景で区切る |
| 目線 | 特に設計なし | 次にやるべきものへ誘導 | 「決められる」「情報不足」の優先表示・視認性向上 |

### 5.3 決裁詳細（/p/:id/decisions/:decisionId）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| 上部 | タイトル、タグ/ステータス/決裁者/期限、保存・確定・不足質問ボタン | 決裁材料の入力が主目的 | 入力項目の優先度付け。よく使うものを前面に |
| メイン（8列） | Card が 5 枚: 選択肢、決定結果、根拠、前提、反証条件 | 必要な時だけ入力するものは退避 | 根拠・前提・反証条件を折りたたみ or サイドパネル候補 |
| サイド（4列） | アクション、不足質問、素案生成、質問を見る | アクションは常時。質問は開く時だけ | 不足質問は既に RightPanel。アクションのグルーピング見直し |
| 境界線 | 各 Card に border、内部も区切り多 | 線が多いと見づらい | グルーピング・余白でまとめる |

### 5.4 会議一覧（/p/:id/meetings）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| 本体 | Card 1 枚、会議一覧（タイトル・日時・ステータス） | 決裁をする場の一覧 | 現状シンプル。議事録貼り付けの導線は会議詳細側 |

### 5.5 会議詳細（/p/:id/meetings/:meetingId）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| 上部 | 会議情報、再解析ボタン | 議事録を貼り付けて送信 → 次の決裁・アクションが紐づく | **議事録貼り付けエリアを追加**（要件未実装） |
| 抽出決裁 | 8 列 Card で一覧 | 何をどう決めるかのまとめ | アジェンダ素案は現状のままでよい |
| エージェントログ | 4 列 Card で常時表示 | 確認時のみ → サイドパネル | ログを RightPanel に退避 or 折りたたみ |

### 5.6 新規会議メモ（/p/:id/meetings/new）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| 入口 | ヘッダーに常時表示 | 決裁が空のときだけ表示 | ヘッダーからの条件表示（本ページは初回用として維持） |
| フォーム | 会議名・日時・参加者・メモ本文、下書き・解析開始 | 初回のみ利用 | 2 回目以降は会議詳細で議事録投入。現画面は初回専用 |

### 5.7 ダッシュボード（/p/:id/dashboard）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| KPI | 4 Card: 未決・決められる・期限超過・決裁者未設定 | 管理職ビューを統合 | Exec の内容（決裁者未設定一覧、期限超過アクション、ワンクリック運用）をダッシュボードに取り込み |
| 会議メモ | 「会議メモを貼り付けて解析」Card | 決裁が空のときだけ新規会議メモ | ダッシュボードは管理向け。新規会議メモ案内は決裁一覧（空時）へ |
| 決裁（上位） | サマリ一覧 | - | 統合後も維持 |
| 次の会議で決める候補 | カード | - | 統合後も維持 |

### 5.8 管理職ビュー（/p/:id/exec）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| 本体 | 決裁者未設定、期限超過、今週決める、一覧、ワンクリック運用 | ダッシュボードに統合 | **ページ廃止**。内容をダッシュボードへ移す |

### 5.9 プロジェクト一覧（/projects）

| 項目 | 現状 | 要件 | 変更案 |
|------|------|------|--------|
| ヘッダー | ロゴ、検索、新規プロジェクト | - | 現状維持 |
| カード | プロジェクト名・説明・メトリクス・開くリンク | 開く → 決裁一覧 | 現状どおり projectHome = decisions |

### 5.10 変更計画サマリ

| 優先度 | 変更内容 |
|--------|----------|
| 高 | 新規会議メモを条件表示（決裁が空のときだけ）【完了】 |
| 高 | ダッシュボードに管理職ビュー統合（/exec 廃止）【完了】 |
| 高 | 会議詳細に議事録貼り付け・送信 UI 追加【完了】 |
| 中 | 決裁詳細のグルーピング・メタ情報の折りたたみ【一部完了】 |
| 中 | 決裁一覧・看板の視認性・目線誘導【一部完了】 |
| 低 | 全体の border 見直し、余白・背景でのグルーピング【着手】 |

---

## 6. 関連ドキュメント

- 認証: [`specs/core/auth.md`](../core/auth.md)
- ローカル開発: [`docs/local/README.md`](../../docs/local/README.md)
